from scrapinghub import ScrapinghubClient
from mocourtscraper.creds import SHUB_API_KEY
import requests
from requests.auth import HTTPBasicAuth
import json
import pandas as pd


def build_frame(case_json):
    df = pd.read_json(case_json, orient='index')
    df = df.transpose()
    case_number_column = []
    for i in range(len(df.index)):
        case_number_column.append(case['case_number'])
    df['case_number'] = case_number_column
    return df
    
def build_frame_records(case_json):
    df = pd.read_json(case_json, orient='records')
    case_number_column = []
    for i in range(len(df.index)):
        case_number_column.append(case['case_number'])
    df['case_number'] = case_number_column
    return df

CLIENT = ScrapinghubClient(SHUB_API_KEY)
PROJECT = CLIENT.get_project(503874)

#jobs = PROJECT.jobs.iter(state=['finished'], spider='cases_search')

job_item_paths = ['/503874/1/542', '/503874/1/544', '/503874/1/541', '/503874/1/543', '/503874/1/539', '/503874/1/540', '/503874/1/538', '/503874/1/537', '/503874/1/536', '/503874/1/534',
 '/503874/1/535', '/503874/1/533', '/503874/1/532', '/503874/1/530', '/503874/1/531', '/503874/1/528', '/503874/1/529', '/503874/1/526', '/503874/1/527', '/503874/1/525',
 '/503874/1/524', '/503874/1/521', '/503874/1/522', '/503874/1/523', '/503874/1/520', '/503874/1/516', '/503874/1/517', '/503874/1/519', '/503874/1/518', '/503874/1/514',
 '/503874/1/515', '/503874/1/511', '/503874/1/513', '/503874/1/512', '/503874/1/509', '/503874/1/507', '/503874/1/510', '/503874/1/508', '/503874/1/505', '/503874/1/506',
 '/503874/1/503', '/503874/1/504', '/503874/1/502', '/503874/1/501', '/503874/1/499', '/503874/1/498', '/503874/1/500', '/503874/1/497', '/503874/1/493', '/503874/1/494',
 '/503874/1/496', '/503874/1/495', '/503874/1/491', '/503874/1/492', '/503874/1/489', '/503874/1/490', '/503874/1/488', '/503874/1/487', '/503874/1/485', '/503874/1/486',
 '/503874/1/481', '/503874/1/484', '/503874/1/480', '/503874/1/483', '/503874/1/478', '/503874/1/482', '/503874/1/477', '/503874/1/479', '/503874/1/475', '/503874/1/476',
 '/503874/1/474', '/503874/1/473', '/503874/1/472', '/503874/1/469', '/503874/1/471', '/503874/1/467', '/503874/1/468', '/503874/1/470', '/503874/1/463', '/503874/1/465',
 '/503874/1/466', '/503874/1/464', '/503874/1/462', '/503874/1/461', '/503874/1/460', '/503874/1/459', '/503874/1/456', '/503874/1/458', '/503874/1/457', '/503874/1/455',
 '/503874/1/454', '/503874/1/453', '/503874/1/452', '/503874/1/451', '/503874/1/450', '/503874/1/449', '/503874/1/448', '/503874/1/447', '/503874/1/441', '/503874/1/446',
 '/503874/1/445', '/503874/1/444', '/503874/1/442', '/503874/1/443', '/503874/1/440', '/503874/1/437', '/503874/1/439', '/503874/1/438', '/503874/1/433', '/503874/1/436',
 '/503874/1/435', '/503874/1/434', '/503874/1/432', '/503874/1/430', '/503874/1/428', '/503874/1/431', '/503874/1/426', '/503874/1/429', '/503874/1/427', '/503874/1/425',
 '/503874/1/424', '/503874/1/416', '/503874/1/423', '/503874/1/421', '/503874/1/422', '/503874/1/420', '/503874/1/418', '/503874/1/419', '/503874/1/415', '/503874/1/417',
 '/503874/1/414', '/503874/1/412', '/503874/1/413', '/503874/1/410', '/503874/1/411', '/503874/1/409', '/503874/1/407', '/503874/1/408', '/503874/1/406', '/503874/1/405',
 '/503874/1/403', '/503874/1/401', '/503874/1/404', '/503874/1/402', '/503874/1/399', '/503874/1/400', '/503874/1/397', '/503874/1/398', '/503874/1/396', '/503874/1/393',
 '/503874/1/394', '/503874/1/389', '/503874/1/395', '/503874/1/390', '/503874/1/392', '/503874/1/391', '/503874/1/387', '/503874/1/385', '/503874/1/388', '/503874/1/386',
 '/503874/1/384', '/503874/1/382', '/503874/1/383', '/503874/1/374', '/503874/1/375', '/503874/1/380', '/503874/1/381', '/503874/1/379', '/503874/1/376', '/503874/1/378',
 '/503874/1/377', '/503874/1/372', '/503874/1/373', '/503874/1/370', '/503874/1/371', '/503874/1/368', '/503874/1/369', '/503874/1/366', '/503874/1/367', '/503874/1/365',
 '/503874/1/364', '/503874/1/363', '/503874/1/362', '/503874/1/361', '/503874/1/360', '/503874/1/358', '/503874/1/359', '/503874/1/357', '/503874/1/356', '/503874/1/355',
 '/503874/1/352', '/503874/1/353', '/503874/1/354', '/503874/1/349', '/503874/1/350', '/503874/1/351', '/503874/1/348', '/503874/1/346', '/503874/1/347', '/503874/1/344',
 '/503874/1/345', '/503874/1/342', '/503874/1/341', '/503874/1/343', '/503874/1/338', '/503874/1/340', '/503874/1/339', '/503874/1/337', '/503874/1/332', '/503874/1/334',
 '/503874/1/336', '/503874/1/333', '/503874/1/335', '/503874/1/328', '/503874/1/330', '/503874/1/331', '/503874/1/329', '/503874/1/325', '/503874/1/327', '/503874/1/326',
 '/503874/1/322', '/503874/1/324', '/503874/1/321', '/503874/1/323', '/503874/1/320', '/503874/1/318', '/503874/1/319', '/503874/1/317', '/503874/1/315', '/503874/1/316',
 '/503874/1/314', '/503874/1/313', '/503874/1/312', '/503874/1/311', '/503874/1/309', '/503874/1/310', '/503874/1/308', '/503874/1/307', '/503874/1/306', '/503874/1/305',
 '/503874/1/304', '/503874/1/303', '/503874/1/302', '/503874/1/300', '/503874/1/299', '/503874/1/301', '/503874/1/298', '/503874/1/296', '/503874/1/295', '/503874/1/297',
 '/503874/1/294', '/503874/1/293', '/503874/1/291', '/503874/1/292', '/503874/1/290', '/503874/1/286', '/503874/1/289', '/503874/1/288', '/503874/1/287', '/503874/1/283',
 '/503874/1/281', '/503874/1/284', '/503874/1/285', '/503874/1/282', '/503874/1/280', '/503874/1/279', '/503874/1/277', '/503874/1/278', '/503874/1/276', '/503874/1/273',
 '/503874/1/275', '/503874/1/274', '/503874/1/272', '/503874/1/271', '/503874/1/270', '/503874/1/269', '/503874/1/267', '/503874/1/268', '/503874/1/265', '/503874/1/266',
 '/503874/1/264', '/503874/1/262', '/503874/1/263', '/503874/1/261', '/503874/1/260', '/503874/1/259', '/503874/1/258', '/503874/1/257', '/503874/1/256', '/503874/1/255',
 '/503874/1/253', '/503874/1/252', '/503874/1/254', '/503874/1/251', '/503874/1/249', '/503874/1/250', '/503874/1/248', '/503874/1/247', '/503874/1/245', '/503874/1/246',
 '/503874/1/244', '/503874/1/242', '/503874/1/241', '/503874/1/243', '/503874/1/240', '/503874/1/239', '/503874/1/238', '/503874/1/237', '/503874/1/236', '/503874/1/235',
 '/503874/1/234', '/503874/1/233', '/503874/1/232', '/503874/1/231', '/503874/1/229', '/503874/1/228', '/503874/1/230', '/503874/1/227', '/503874/1/226', '/503874/1/224',
 '/503874/1/225', '/503874/1/223', '/503874/1/222', '/503874/1/220', '/503874/1/221', '/503874/1/219', '/503874/1/218', '/503874/1/214', '/503874/1/216', '/503874/1/215',
 '/503874/1/217', '/503874/1/212', '/503874/1/210', '/503874/1/213', '/503874/1/211', '/503874/1/209', '/503874/1/207', '/503874/1/208', '/503874/1/206', '/503874/1/205',
 '/503874/1/204', '/503874/1/202', '/503874/1/203', '/503874/1/200', '/503874/1/201', '/503874/1/199', '/503874/1/196', '/503874/1/197', '/503874/1/198', '/503874/1/195',
 '/503874/1/194', '/503874/1/193', '/503874/1/190', '/503874/1/191', '/503874/1/192', '/503874/1/185', '/503874/1/189', '/503874/1/188', '/503874/1/187', '/503874/1/184',
 '/503874/1/186', '/503874/1/183', '/503874/1/181', '/503874/1/182', '/503874/1/179', '/503874/1/177', '/503874/1/180', '/503874/1/175', '/503874/1/178', '/503874/1/176',
 '/503874/1/174', '/503874/1/173', '/503874/1/171', '/503874/1/172', '/503874/1/170', '/503874/1/167', '/503874/1/169', '/503874/1/166', '/503874/1/168', '/503874/1/163',
 '/503874/1/164', '/503874/1/165', '/503874/1/162', '/503874/1/161', '/503874/1/160', '/503874/1/159', '/503874/1/158', '/503874/1/157', '/503874/1/156', '/503874/1/153',
 '/503874/1/154', '/503874/1/155', '/503874/1/152', '/503874/1/150', '/503874/1/151', '/503874/1/149', '/503874/1/147', '/503874/1/148', '/503874/1/144', '/503874/1/146',
 '/503874/1/145', '/503874/1/143', '/503874/1/142', '/503874/1/141', '/503874/1/140', '/503874/1/139', '/503874/1/138', '/503874/1/135', '/503874/1/136', '/503874/1/137',
 '/503874/1/134', '/503874/1/133', '/503874/1/131', '/503874/1/132', '/503874/1/129', '/503874/1/130', '/503874/1/128', '/503874/1/126', '/503874/1/127', '/503874/1/125',
 '/503874/1/123', '/503874/1/124', '/503874/1/122', '/503874/1/120', '/503874/1/121', '/503874/1/118', '/503874/1/117', '/503874/1/119', '/503874/1/114', '/503874/1/116',
 '/503874/1/115', '/503874/1/113', '/503874/1/112', '/503874/1/111', '/503874/1/110', '/503874/1/109', '/503874/1/108', '/503874/1/107', '/503874/1/106', '/503874/1/105',
 '/503874/1/104', '/503874/1/103', '/503874/1/102', '/503874/1/101', '/503874/1/100', '/503874/1/99', '/503874/1/98', '/503874/1/97', '/503874/1/96', '/503874/1/95',
 '/503874/1/94', '/503874/1/93', '/503874/1/92', '/503874/1/91', '/503874/1/90', '/503874/1/89', '/503874/1/88', '/503874/1/87', '/503874/1/86', '/503874/1/85',
 '/503874/1/84', '/503874/1/83', '/503874/1/82', '/503874/1/81', '/503874/1/80', '/503874/1/79', '/503874/1/78', '/503874/1/77', '/503874/1/76', '/503874/1/75',
 '/503874/1/74', '/503874/1/73', '/503874/1/72', '/503874/1/71', '/503874/1/70', '/503874/1/69', '/503874/1/68', '/503874/1/67', '/503874/1/66', '/503874/1/65',
 '/503874/1/64', '/503874/1/63', '/503874/1/62', '/503874/1/61', '/503874/1/60', '/503874/1/59', '/503874/1/58', '/503874/1/57', '/503874/1/56', '/503874/1/55',
 '/503874/1/54', '/503874/1/53', '/503874/1/52', '/503874/1/51', '/503874/1/50', '/503874/1/49', '/503874/1/48', '/503874/1/47', '/503874/1/46', '/503874/1/45',
 '/503874/1/44', '/503874/1/43', '/503874/1/42', '/503874/1/41', '/503874/1/40', '/503874/1/39', '/503874/1/38', '/503874/1/37', '/503874/1/36', '/503874/1/35',
 '/503874/1/34', '/503874/1/33', '/503874/1/32', '/503874/1/31', '/503874/1/30', '/503874/1/29', '/503874/1/28', '/503874/1/27', '/503874/1/26', '/503874/1/25',
 '/503874/1/24', '/503874/1/23', '/503874/1/22', '/503874/1/21', '/503874/1/20', '/503874/1/19', '/503874/1/18', '/503874/1/17', '/503874/1/16', '/503874/1/15',
 '/503874/1/14', '/503874/1/13', '/503874/1/12', '/503874/1/11', '/503874/1/10', '/503874/1/9', '/503874/1/7', '/503874/1/6']

""" item_url = 'https://storage.scrapinghub.com/items' + job_item_paths[0]
r = requests.get(item_url, auth=HTTPBasicAuth(SHUB_API_KEY,''), headers={'Accept': 'application/json'}) """

final_output = {}
header_frame = pd.DataFrame()
parties_frame = pd.DataFrame()
charges_frame = pd.DataFrame()
with open('data_file.json', 'r') as read_file:
    json_data = json.load(read_file)
    for case in json_data:
        if 'header' in case.keys():
            case_json = json.dumps(case['header'])
            df = build_frame(case_json)
            header_frame = header_frame.append(df, ignore_index=True)
        if 'parties' in case.keys():
            case_json = json.dumps(case['parties'])
            df = build_frame_records(case_json)
            parties_frame = parties_frame.append(df, ignore_index=True)
        if 'charges' in case.keys():
            case_json = json.dumps(case['charges'])
            df = build_frame_records(case_json)
            charges_frame = charges_frame.append(df, ignore_index=True)

charges_frame.to_csv('charges_output.csv')

parties_frame.to_csv('parties_output.csv')

header_frame.to_csv('header_output.csv')